<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Clue</title>
    <script type="text/javascript">
        // Array of video URLs
        var videoLinks = [
            "video_clues/video1.mp4",
            "video_clues/video2.mp4",
            "video_clues/video3.mp4"
        ];

        var totalVideos = videoLinks.length;  // Total number of videos

        // Function to generate a unique session ID for each device
        function generateSessionID() {
            return 'session-' + Math.random().toString(36).substr(2, 9);  // Random unique ID
        }

        // Small delay to prevent race conditions between devices accessing at the same time
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Function to assign the next video in sequence, without repeating the last one at cycle restart
        async function getNextVideoIndex() {
            // Introduce a small delay to prevent race condition when multiple devices access the page
            await delay(Math.floor(Math.random() * 100) + 50);

            // Get the total number of accesses from localStorage (default to 0 if not set)
            var accessCount = localStorage.getItem('accessCount') || 0;

            // Get the last video shown (default to -1 if not set)
            var lastVideoIndex = localStorage.getItem('lastVideoIndex') || -1;

            // Calculate the next video index, ensuring it's not the same as the last one
            var nextVideoIndex = (parseInt(lastVideoIndex) + 1) % totalVideos;

            // Store the new access count and the new last video index
            localStorage.setItem('accessCount', parseInt(accessCount) + 1);
            localStorage.setItem('lastVideoIndex', nextVideoIndex);

            return nextVideoIndex;
        }

        // On page load, set the video source to the appropriate video
        window.onload = async function() {
            // Check if a session video has already been assigned for this device
            var sessionVideoIndex = sessionStorage.getItem('videoIndex');

            if (sessionVideoIndex === null) {
                // If no video was assigned yet, generate a session ID and assign the next video
                var sessionID = generateSessionID();
                sessionStorage.setItem('sessionID', sessionID);  // Store session ID (for future use)

                var videoIndex = await getNextVideoIndex();  // Get the next video in sequence
                sessionStorage.setItem('videoIndex', videoIndex);  // Store it in sessionStorage
            } else {
                // If video is already assigned in the session, use the stored videoIndex
                videoIndex = sessionVideoIndex;
            }

            // Get the corresponding video URL based on the assigned video index
            var videoUrl = videoLinks[videoIndex];
            document.getElementById("video-player").src = videoUrl;  // Set the video source
        }
    </script>

    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Treasure Hunt Final Clue</h1>

    <!-- Video player to embed the video -->
    <video id="video-player" width="640" height="360" controls autoplay muted loop>
        <source src="" type="video/mp4">
        Your browser does not support the video tag.
    </video>
</body>
</html>













